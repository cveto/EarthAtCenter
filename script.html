<!DOCTYPE html>
<html>

<script>
// CONSTANTS
var c0=2.99792458	// *10^8	speed of light in vacuum

var fgreen=565;		// THz 10^12	green color median frequency
var fred=442.5;		// THz 10^12	red   color median frequency
var fblue=640;		// THz 10^12	blue  color median frequency

var ftest2=299.792458;	// freqency at which wavelength exzactly 1 micrometer.
var ftest=299.792458;

var slowdown;

// CANVAS PRESENTATION VARIABLES
var ctx;
var sampling=200; 		// SAMPLES PER PERIOD
var DPmm=50;			// DOTS PER MICROMETER OF WAVELENGTH REPRESENTED ON SCREEN

var t=0;
var tslow;
var intervalms=10;		// values will be calculated for every 10 miliseconds  - time resolution

var xCenter1=350;
var yCenter1=350;


// WAVES
//  wave1[xstart0,ystart1,xrotate2,yrotate3,tilt4,raylength5,wavelength6,frequency7,Amplitude8,refractiveIndex9]
var wave1=["empty",  "empty",  "empty",  "empty", "empty", 5, "empty",   ftest, 10,1];		// By default 2 and 3 are set to 1 and 2
var wave2=["empty", "empty", "empty", "empty", "empty", 5, "empty",   ftest,  10,1.6]		// by default 2 and 3 are ignored

// MATERIALS
var n1=1;
var n2=1.6;
var wall1=[418,118,430,1000];

function init() {
	//ctx= myCanvas.getContext('2d');
	setInterval(draw,intervalms);	 				// 10 milisecond - 100 per second
	//draw();
}

function drawRay(wave,ctx,xStart,yStart,tilt,phaseShift) {

	// Pulled 
	var fTHz=wave[7];				// f in TeraHerz 10^12
	var fEHz=wave[7]/1000/1000;		// f in EksaHerz 10^18
	var raylength = wave[5];		// length of wave in micrometers in the direction of movement for presentation purposes)
	var Amp=wave[8];				// Wave Amplitude - has no meaning, just to make it nice on the canvas
	// Calculated
	var n=wave[9];					// refractive index of medium where the wave is
	var lambda1=c0/n/fTHz*100		// wavelenght of ray in micrometers
	var numPeriodsToDraw=raylength/lambda1;		// depends on the length of the ray. But can be overwriten
	var numPeriodsToDraw=Math.round(numPeriodsToDraw);
	
	
	var w1=2*Math.PI*fEHz;			// Angular speed in rad/(10^18s)

	var rotatex = xStart;			// By default the rotation is around the starting point of the wave
	var rotatey = yStart;
	
	// start drawing where?
	ctx.moveTo(xStart,yStart);	

	// rotate around what point?
	ctx.translate(rotatex,rotatey);		
	ctx.rotate(tilt * Math.PI / 180);
	ctx.translate(-rotatex,-rotatey);
	
	// Calculated
	var k1 = 2*Math.PI/lambda1;							// Wavenumber in 1/micrometers

	for (var i=0;i<=numPeriodsToDraw*sampling;++i) {	// All is relative to wavelenght
	
		var x=i*lambda1/sampling;						// One wavelenght divided in XY samples, x is width between samples and depends on the wavelength.
		var mmppx=x*DPmm								// StretchFactor (How many pixels represents a micrometer of a wavelenght
		
		//--------------------
		var f1=Amp*Math.sin(k1*x-w1*tslow+phaseShift);		// MAIN EQUATION
		//--------------------
		
		if(document.getElementById("markWaves").checked == '1'){	
			//ctx.lineTo(xStart+x,yStart+f1);			// Connets lines
			ctx.rect(xStart+mmppx,yStart+f1, 1, 1);		// Makes dots
		}
		
		if(f1<-Amp*(0.999) && document.getElementById("markFronts").checked == '1'){							// Detecting peak.. one way of doing it
			ctx.rect(xStart+mmppx,yStart-25,0.5,50);
			};

		//if(t%sampling==i){							// Detecting peak.. one way of doing it
		//	for (var j=0;j<numPeriodsToDraw;j++) {
		//		ctx.rect(xStart+j*DPmm+mmppx,yStart,0.5,50);
		//		
		//	}
		//};	
	}

	// Rotate K.O. back
	ctx.translate(rotatex,rotatey);
	ctx.rotate(-tilt * Math.PI / 180);
	ctx.translate(-rotatex,-rotatey);	
}

function draw() {
	var c = document.getElementById("myCanvas");
	var ctx = c.getContext("2d");

	
	ctx.beginPath();
	
	ctx.rect(30, 10, DPmm, 2);			// 1 micrometer
	ctx.rect(0, 350, 5000, 2);			// Horizontal Line
	ctx.rect(350, 0, 2,5000);
	
	// item: Wave 1
	// frequency
	wave1[7]=document.getElementById("range_frequency1").value;
	wave2[7]=wave1[7];
	document.getElementById("value_frequency1").innerHTML=wave1[7];
	
	var n1=1.6;
	var theta1=15;							// Angle from vertical middle line
	theta1=document.getElementById("theta1").value;
	document.getElementById("value_theta1").innerHTML=theta1;

	var tilt=90-theta1;						// Angle from horizontal line... because Javascript
	var thetaRad=Math.PI/180*(theta1);		// Theta in radians
	var xStart=xCenter1-wave1[5]*DPmm*Math.cos(tilt*Math.PI/180);
	var yStart=yCenter1-wave1[5]*DPmm*Math.sin(tilt*Math.PI/180);

	drawRay(wave1,ctx,xStart,yStart,tilt,0);
	var xEndWave1 = xStart+wave1[5]*DPmm*Math.cos(tilt*Math.PI/180);
	var yEndWave1 = yStart+wave1[5]*DPmm*Math.sin(tilt*Math.PI/180);
	
	// item: Wave 2
	var n2=1;
	var theta2rad=Math.asin(Math.sin(thetaRad)*n1/n2);		// Sneels Law
	var tilt2=90-theta2rad*180/Math.PI;
	
	if (isNaN(theta2rad)) {				// Total reflection, 
		theta2rad=thetaRad-Math.PI/2;
		tilt2=theta2rad*180/Math.PI;
		drawRay(wave1,ctx,xEndWave1,yEndWave1,tilt2,-Math.PI/2);
	} else {
		drawRay(wave2,ctx,xEndWave1,yEndWave1,tilt2,0);
	}
	//
	
	
	// Clear Image
	ctx.clearRect(0,0, 3000,3000);
	ctx.stroke();
	
	// Time goes forward?
	slowdown=document.getElementById("timespeed").value;
	document.getElementById("value_speed").innerHTML=slowdown;
	
	t+=1;
	tslow=t*slowdown;	
	document.getElementById("value_time").innerHTML=Math.floor(t/1000*slowdown*10)/10;

	
}

</script>

<body onLoad="init();">
TEST:<div id="test1">ready</div><br>
FREQUENCY: <span id="value_frequency1"></span>THz<input type="range" id="range_frequency1" min="0" max="2000" value="299.792458"> <br/>
THETA1: <span id="value_theta1"></span><input type="range" id="theta1" min="0" max="90" value="45"> <br/>
SPEED: x<span id="value_speed"></span> <input type="range" id="timespeed" min="0" max="80" value="10"></br>
TIME: [femtoseconds (10^-15) ]  <span id="value_time"></span><br />
Waves: <input type="checkbox" id="markWaves" checked="1"> | Fronts: <input type="checkbox" id="markFronts" checked="1"> | 
GRAY LINE is 1 micrometer
<canvas id="myCanvas" width="3000" height="3000" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>


</body>
</html>
