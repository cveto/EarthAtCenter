<script>

// This is a model which simulates OUR solar system. It's based on real eliptical trajectories. 
// Distances from sun to the planets are scalled correctly. 
// Sizes of planets not scaled for obvious reasons. (planets to tiny to show on canvas)
// CLICK ON THE BUTTON FOR GEOCENTRICAL MODEL and see how planets move if you take EARTH as the center of the universe.
// Interesting thing: Trajectories tend to cross over one another - but it's fairly obvious planet won't bump together from the/
// Heliocentrical model. So what gives?


// Declaring global variables.. is this necessary?
var context;

/////////// CONSTANTS and it's derivations ////////////
// Year length for planets in Earth days
var daysMercury=87.97;
var daysVenus=224.701;
var daysEarth=365.265;
var daysMars=686.971;
var daysJupiter=4332.59;
var daysSaturn=10759.22;
var daysUranus=30688.5;
var daysNeptune=60182;
var daysPluto=90560;

// Distance from planets Sun in Astronomival units (calucaltions come from the eliptical equatino in kartezian coordinates)
	// Mercury
var distMercury=0.39;
var aphelionMercury=0.46667;
var perihelionMercury=0.307499;
var amplitudeXMercury=(aphelionMercury+perihelionMercury)/2; 		
var linear_e_Mercury=amplitudeXMercury-perihelionMercury;					
var amplitudeYMercury=Math.sqrt(Math.pow(amplitudeXMercury,2)-Math.pow(linear_e_Mercury,2));

	// Venus
var distVenus=0.723;
var aphelionVenus=0.728213;
var perihelionVenus=0.716449;
var amplitudeXVenus=(aphelionVenus+perihelionVenus)/2; 		
var linear_e_Venus=amplitudeXVenus-perihelionVenus;					
var amplitudeYVenus=Math.sqrt(Math.pow(amplitudeXVenus,2)-Math.pow(linear_e_Venus,2));

	// Earth
var distEarth=1;  // around 1, +- and
var aphelionEarth=1.0167;
var perihelionEarth=0.98329;
var amplitudeXEarth=(aphelionEarth+perihelionEarth)/2; 		 // How much left and right for X
var linear_e_Earth=amplitudeXEarth-perihelionEarth;					// offset How much away from the center of elipse
var amplitudeYEarth=Math.sqrt(Math.pow(amplitudeXEarth,2)-Math.pow(linear_e_Earth,2));

	// Mars
var distMars=1.524; 
var aphelionMars=1.666;
var perihelionMars=1.382;
var amplitudeXMars=(aphelionMars+perihelionMars)/2; 		
var linear_e_Mars=amplitudeXMars-perihelionMars;					
var amplitudeYMars=Math.sqrt(Math.pow(amplitudeXMars,2)-Math.pow(linear_e_Mars,2));

	// Jupiter
var distJupiter=5.203;
var aphelionJupiter=5.4588;
var perihelionJupiter=4.9501;
var amplitudeXJupiter=(aphelionJupiter+perihelionJupiter)/2; 		
var linear_e_Jupiter=amplitudeXJupiter-perihelionJupiter;					
var amplitudeYJupiter=Math.sqrt(Math.pow(amplitudeXJupiter,2)-Math.pow(linear_e_Jupiter,2));

	// Saturn
var distSaturn=9.539;
var distUranus=19.18;
var distNeptune=30.06;
var distPluto=39.5
var distMoon;

	// Weighing Astronomical units so they can fit on the Canvas nicely.
var distWeight=110;


// Starting position of the planetary body on the canvas (1000px down, 1000px right from top left corner)
// Only center for sun and Earth is really needed, the rest was put there for future proofing and because I like to declare variables.
var posCenterX=1000;
var posCenterY=1000;
var posSunX=posCenterX;
var posSunY=posCenterY;
var posMercuryX=posCenterX;
var posMercuryY=posCenterY;
var posVenusX=posCenterX;
var posVenusY=posCenterY;
var posEarthX=posCenterX;
var posEarthY=posCenterY;
var posMarsX=posCenterX;
var posMarsY=posCenterY;
var posJupiterX=posCenterX;
var posJupiterY=posCenterY;
var posSaturnX=posCenterX;
var posSaturnY=posCenterY;
var posUranusX=posCenterX;
var posUranusY=posCenterY;
var posNeputneX=posCenterX;
var posNeptuneY=posCenterY;
var posPlutoX=posCenterX;
var posPlutoY=posCenterY;
var posMoonX;
var posMoonY;

// Speed of going around the sun
var speedEarth; 			// max 1
var drawInterval=1;

// Poolar coordinate of the planetary body (used to derivate it to cartesian)
// fi goes from -3.14 to +3.14 radians
var fi=0;
var fiMercury=0;
var fiVenus=0;
var fiMars=0;
var fiJupiter=0;

// fid will be weighed. Would be smarter to make cos(omega*t)
var fid;
var fidMercury;
var fidVenus;
var fidMars;
var fidJupiter;

// Ectra feautures.
var drawOn=0;
var testOn=0;
var dfi=1;				// How much the angle changes per frame

var stikalo=0;			// Button is OFF
var earthYears=0;	
var pause = 1;
var linethickness=2;


function init()
{
  // Loads on page load. Sets upa  canvas and calls function many times per second
  context= myCanvas.getContext('2d');
  setInterval(draw,drawInterval);					// Calls function draw 40 times a...? Well often.	
 
}

function draw()
{
	// SPEEDS OF PLANETS REALTIVE TO EARTH
	// Why was this done like this and not with angular frequency?
	// Because relative speed doesn't matter. All that matters is the realitve body speed.
	speedEarth = document.getElementById("sliderSpeed").value/1000;
	
	var speedMercury=speedEarth/(daysMercury/daysEarth);
	var speedVenus=speedEarth/(daysVenus/daysEarth);
	var speedMars=speedEarth/(daysMars/daysEarth);
	var speedJupiter=speedEarth/(daysJupiter/daysEarth);
	var speedSaturn=speedEarth/(daysSaturn/daysEarth);
	var speedUranus=speedEarth/(daysUranus/daysEarth);
	//var speedNeptune=speedEarth/(daysNeptune/daysEarth);
	//var speedPluto=speedEarth/(daysPluto/daysEarth);
	var speedMoon;
 
 
	// DRAW LINES?
	if (drawOn == 0) {
		context.clearRect(0,0, 3000,3000);
	}
   
    // FI angle of the EARTH (omega*t) fid is (speed*omega*t)
	fi+=0.1*dfi;
	fid = speedEarth*fi;
	if (fid > Math.PI*2) {
		fi = 0;
		earthYears+=1;
	}
	fi+=0.1*dfi;
	
    // MERCURY phi
	fiMercury+=0.1*dfi;
	fidMercury = speedMercury*fiMercury;
	if (fidMercury > Math.PI*2) {
		fiMercury = 0;
	}
	fiMercury+=0.1*dfi;

    // VENUS phi
	fiVenus+=0.1*dfi;
	fidVenus = speedVenus*fiVenus;
	if (fidVenus > Math.PI*2) {
		fiVenus = 0;
	}
	fiVenus+=0.1*dfi;

    // MARS phi
	fiMars+=0.1*dfi;
	fidMars = speedMars*fiMars;
	if (fidMars > Math.PI*2) {
		fiMars = 0;
	}
	fiMars+=0.1*dfi;

	// JUPITER phi
	fiJupiter+=0.1*dfi;
	fidJupiter = speedJupiter*fiJupiter;
	if (fidJupiter > Math.PI*2) {
		fiJupiter = 0;
	}
	fiJupiter+=0.1*dfi;	

	
    // Save old coordinates of Earth for Geocentric model 
	// Why? So I know how to move the coordinate system to put Earth always to the center
	posEarthOLDx=posEarthX;
	posEarthOLDy=posEarthY;
	
	// COORDINATES OF EARTH
	posEarthX = posSunX+linear_e_Earth+distWeight*amplitudeXEarth*Math.cos(fid);
	posEarthY = posSunY+distWeight*amplitudeYEarth*Math.sin(fid);
	
	// BUTTON TO PUT EARTH TO CENTER (Resets coordinates)
	button_Test.onclick = function(event) {
	posEarthX=posCenterX;
	posEarthY=posCenterY;
	context.setTransform(1, 0, 0, 1, 0, 0);			// Resets the canvas
    };
	
	// Toggle between Geocentrical and Heliocentrical model - for EARTH only
 	if (stikalo == 1) {
		trnx=posEarthOLDx-posEarthX;
		trny=posEarthOLDy-posEarthY;
		context.translate(trnx, trny);
    	document.getElementById("button").innerHTML = "Swithch to HELIOCENTRICAL model";
	} else {
		document.getElementById("button").innerHTML = "Swithch to GEOCENTRICAL model";
	}

    // COORDINATES of moon
	posMoonX = posEarthX+20*Math.sin(27.322*fid);
	posMoonY = posEarthY+20*Math.sin(27.322*fid-Math.PI/2);
	
	// COORDINATES of Mercury
	posMercuryX = posSunX+linear_e_Mercury+distWeight*amplitudeXMercury*Math.cos(fidMercury);
	posMercuryY = posSunY+distWeight*amplitudeYMercury*Math.sin(fidMercury);
	
	// COORDINATES of Venus
	posVenusX = posSunX+linear_e_Venus+distWeight*amplitudeXVenus*Math.cos(fidVenus);
	posVenusY = posSunY+distWeight*amplitudeYVenus*Math.sin(fidVenus);

	// COORDINATES of Mars	
	posMarsX = posSunX+linear_e_Mars+distWeight*amplitudeXMars*Math.cos(fidMars);
	posMarsY = posSunY+distWeight*amplitudeYMars*Math.sin(fidMars);

	// COORDINATES of Jupiter
	posJupiterX = posSunX+linear_e_Jupiter+distWeight*amplitudeXJupiter*Math.cos(fidJupiter);
	posJupiterY = posSunY+distWeight*amplitudeYJupiter*Math.sin(fidJupiter);


  // TOGGLE BUTTON - between HELIOCENTRICAL or GEOCENTRICAL model
  button.onclick = function(event) {
	context.clearRect(-3000,-3000, 3000,3000);
	if (stikalo==0) {
		stikalo = 1;
	} else if (stikalo==1) {
		stikalo = 0;
	}
  };
	
  // TOGGLE BUTTON - DRAW ON or OFF
  button_Draw.onclick = function(event) {
	if (drawOn==0) {
		drawOn = 1;
		earthYears=0;
		document.getElementById("button_Draw").innerHTML = "DRAW OFF";
	} else if (drawOn==1) {
		drawOn = 0;
		document.getElementById("button_Draw").innerHTML = "DRAW ON";
	}
  };

////////// HERE is where I tell javascript to actually put anything on the canvas
	var planetsize=30
	context.beginPath();
	
	
	
	  // SUN
	if (document.getElementById("markSun").checked == '1') {
	  context.fillStyle = 'orange';
	  context.fillRect(posSunX, posSunY, linethickness, linethickness);
	} 
	  // MERCURY
	if (document.getElementById("markMercury").checked == '1') {
	  context.fillStyle = 'blue';
	  context.fillRect(posMercuryX, posMercuryY, linethickness, linethickness);
		

	}  

	  // VENUS
	if (document.getElementById("markVenus").checked == '1') {
	  context.fillStyle = 'yellow';
	  context.fillRect(posVenusX, posVenusY, linethickness, linethickness);
	  

	} 

	  // EARTH
	if (document.getElementById("markEarth").checked == '1') {
	  context.fillStyle = 'green';
	  context.fillRect(posEarthX, posEarthY, linethickness, linethickness);
	  

	} 
	  
	  // MOON
	if (document.getElementById("markMoon").checked == '1') {
	  context.fillStyle = 'black';
	  context.fillRect(posMoonX, posMoonY, linethickness, linethickness);
	} 

	  // MARS
	if (document.getElementById("markMars").checked == '1') {
		context.fillStyle = 'red';
		context.fillRect(posMarsX, posMarsY, linethickness, linethickness);
		
	} 

	  // JUPITER
	if (document.getElementById("markJupiter").checked == '1') {
	  context.fillStyle = 'blue';
	  context.fillRect(posJupiterX, posJupiterY, linethickness, linethickness);
	}
	
	// DRAW lines if DRAW is on
	if (drawOn!=1) {
		var imgjupiter = document.getElementById("imgjupiter");
		context.drawImage(imgjupiter, posJupiterX-planetsize/2, posJupiterY-planetsize/2,planetsize,planetsize);

		var imgmars = document.getElementById("imgmars");
		context.drawImage(imgmars, posMarsX-planetsize/2, posMarsY-planetsize/2,planetsize,planetsize);
		
	    var imgearth = document.getElementById("imgearth");
	    context.drawImage(imgearth, posEarthX-planetsize/2, posEarthY-planetsize/2,planetsize,planetsize);
	  
	    var imgvenus = document.getElementById("imgvenus");
	    context.drawImage(imgvenus, posVenusX-planetsize/2, posVenusY-planetsize/2,planetsize,planetsize);
		  
		var imgmercury = document.getElementById("imgmercury");
	    context.drawImage(imgmercury, posMercuryX-planetsize/2, posMercuryY-planetsize/2,planetsize,planetsize);
		
		var imgsun = document.getElementById("imgsun");
		context.drawImage(imgsun, posSunX-planetsize/2, posSunY-planetsize/2,planetsize,planetsize);
	}

	context.closePath();
	context.fill();


	// Get variables from HTML to JAVASCRIPT
	document.getElementById("earthYears").innerHTML = earthYears;  
	distWeight = document.getElementById("sliderSize").value;
}
</script>

<body bgcolor="white" onLoad="init();">
	<button id="button">Switch to GEOCENTRICAL Model</button>	
	<button id="button_Draw">DRAW ON</button>  
	<button id="button_Test">CENTRALIZE VIEW</button>
	<p>Earth Years: +1Y error: <span id="earthYears"></span></p>
	<p>Pause status: <span id="pauseStatus">unknown</span></p>

Mercury: <input type="checkbox" id="markMercury" checked="1"> | 
Venus: <input type="checkbox" id="markVenus" checked="1"> | 
Earth: <input type="checkbox" id="markEarth" checked="1"> | 
Mars: <input type="checkbox" id="markMars" checked="1"> | 
Jupiter: <input type="checkbox" id="markJupiter" checked="1"> | 
Sun: <input type="checkbox" id="markSun" checked="1"> | 
Moon: <input type="checkbox" id="markMoon" checked="1">
SIZE: <input type="range" id="sliderSize" min="1" max="200" value="160">
SPEED: <input type="range" id="sliderSpeed" min="0" max="300" value="20">

  <canvas id="myCanvas" width="5000" height="5000" >
  </canvas>

<!-- They are here because I didn't find a nother way for Javascript to load images from file. -->
<img id="imgsun" src="sun.png" style="display: none;" />
<img id="imgmercury" src="mercury.png" style="display: none;" />
<img id="imgvenus" src="venus.png" style="display: none;" />
<img id="imgearth" src="earth.png" style="display: none;" />
<img id="imgmars" src="mars.png" style="display: none;" />
<img id="imgjupiter" src="jupiter.png" style="display: none;" />
<img id="imgmoon" src="moon.png" style="display: none;" />
</body>
